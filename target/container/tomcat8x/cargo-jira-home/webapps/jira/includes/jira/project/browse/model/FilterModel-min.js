define("jira/project/browse/filtermodel",["backbone","jquery","wrm/context-path","jira/util/navigation"],function(e,t,r,i){"use strict";var n=r();return e.Model.extend({defaults:{contains:""},initialize:function(e,t){this.pageableCollection=t.pageableCollection,this.on("change:category change:contains change:projectType",this.filterCollection),this.on("change:category change:contains change:projectType",this.triggerFilterEvent)},changeCategory:function(e){e&&(t.ajax({url:n+"/rest/api/1.0/browse-project/category/active",data:JSON.stringify({current:e.get("id")}),dataType:"json",contentType:"application/json",type:"POST"}),this.set("category",e.toJSON()))},changeProjectType:function(e){e&&(t.ajax({url:n+"/rest/api/1.0/browse-project/project-type/active",data:e.get("id"),dataType:"json",contentType:"application/json",type:"POST"}),this.set("projectType",e.toJSON()))},filterCollection:function(){var e=this.pageableCollection.originalCollection,t=this.get("category")?this.get("category").id:"",r=this.get("projectType")?this.get("projectType").key:null,i=(this.get("contains")||"").toLowerCase();e=this.filterByProjectType(r,e),e=this.filterByCategory(t,e),e=this.filterByText(i,e),this.pageableCollection.fullCollection.reset(e),this.pageableCollection.getPage(1)},filterByProjectType:function(e,t){return null==e||"all"===e?t:t.filter(function(t){return t.projectTypeKey===e||""===e&&null===t.projectTypeKey})},filterByCategory:function(e,t){return e?"archived"===e?t.filter(function(e){return e.archived}):(t=t.filter(function(e){return!e.archived}),t.filter(function(t){switch(e){case"all":return!0;case"none":return!t.projectCategoryId;case"recent":return t.recent;default:return t.projectCategoryId&&t.projectCategoryId.toString()===e.toString()}})):t.filter(function(e){return!e.archived})},filterByText:function(e,t){return e?t.filter(function(t){return t.name&&t.name.toLowerCase().indexOf(e)>-1||t.key&&t.key.toLowerCase().indexOf(e)>-1||t.lead&&t.lead.toLowerCase().indexOf(e)>-1}):t},triggerFilterEvent:function(){this.trigger("filter",this.getQueryParams(!1))},getQueryParams:function(e){e=void 0===e||e;var t={selectedCategory:this.get("category")?this.get("category").id:"",selectedProjectType:this.get("projectType")?this.get("projectType").key:"",contains:this.get("contains")||!1};return"archived"===t.selectedCategory?t.s="view_archived_projects":"all"===t.selectedCategory&&(t.s="view_projects"),e?i.buildQuery(t):t}})});